version: "3.1"

stories:
  - story: Happy path - Full order flow
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: ask_product_info
        entities:
          - product: "iPhone 16"
      - slot_was_set:
          - product: "iPhone 16"
      - action: action_provide_product_info
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - slot_was_set:
          - product: null
          - variant_name: null
          - quantity: null
      - intent: goodbye
      - action: utter_goodbye
  - story: Xử lý đặt hàng thành công sau khi form hoàn tất
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - slot_was_set:
          - product: null
          - variant_name: null
          - quantity: null
      - intent: goodbye
      - action: utter_goodbye

  - story: Happy path - Người dùng cung cấp ID ngay
    steps:
      - intent: ask_order_specific
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - action: action_check_order_specific
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"

  - story: Hỏi chung chung, bot hỏi lại ID
    steps:
      - intent: ask_order_general
      - action: utter_ask_order_id
      - intent: ask_order_specific
        entities:
          - order_id: "1234567890abcdef12345678"
      - action: action_check_order_specific
      - slot_was_set:
          - order_id: "1234567890abcdef12345678"
          
  - story: Hỏi đơn hàng (có chỉ số)
    steps:
      - intent: ask_order_general # "đơn hàng mới thứ 2"
        entities:
          - order_direction: "newest"
          - order_index: "2" 
      - action: action_check_order_general
      - slot_was_set:
          - order_direction: "newest"
      - slot_was_set:
          - order_index: "2"

  - story: Hỏi đơn hàng (mới nhất)
    steps:
      - intent: ask_order_general 
        entities:
          - order_direction: "newest"
          - order_index: "1"
      - action: action_check_order_general
      - slot_was_set:
          - order_direction: "newest"
      - slot_was_set:
          - order_index: "1"

  - story: Hỏi lọc theo trạng thái
    steps:
      - intent: ask_order_filter # "xem các đơn đang giao"
        entities:
          - order_status: "đang giao"
      - action: action_check_order_filter # Bot lọc các đơn "đang giao"
      - slot_was_set:
          - order_status: "đang giao"

  - story: Hỏi lọc theo ngày
    steps:
      - intent: ask_order_filter # "đơn hàng hôm qua"
        entities:
          - time: "hôm qua"
      - action: action_check_order_filter # Bot lọc các đơn "hôm qua"
      - slot_was_set:
          - time: "hôm qua"

  - story: Happy path - Quick order flow
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - intent: goodbye
      - action: utter_goodbye

  - story: Happy path - Direct order with product
    steps:
      - intent: order
        entities:
          - product: "iPhone 16"
      - slot_was_set:
          - product: "iPhone 16"
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - intent: goodbye
      - action: utter_goodbye

  - story: Unhappy path - Cancel order after preview
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: cancel_order
      - action: action_cancel_order
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Ask about order
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: ask_order
      - action: action_provide_order_info
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Ask about warranty
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: ask_warranty
      - action: action_provide_warranty_info
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Ask about store
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: ask_store
      - action: action_provide_store_info
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Handle out of scope
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: out_of_scope
      - action: utter_fallback
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Ask about product only
    steps:
      - intent: greet
      - action: action_get_user_info
      - intent: ask_product_info
        entities:
          - product: "iPhone 16"
      - slot_was_set:
          - product: "iPhone 16"
      - action: action_provide_product_info
      - intent: goodbye
      - action: utter_goodbye

  - story: Interaction - Compare products with form
    steps:
      - intent: compare_products
      - action: compare_products_form
      - active_loop: compare_products_form
      - active_loop: null
      - action: action_compare_products

  - story: Interaction - Compare products directly
    steps:
      - intent: compare_products
        entities:
          - product_1: "iPhone 16"
          - product_2: "Galaxy S24"
      - slot_was_set:
          - product_1: "iPhone 16"
          - product_2: "Galaxy S24"
      - action: action_compare_products

  - story: User asks for a specific order
    steps:
      - intent: ask_order
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"
      - action: action_provide_order_info

  - story: User checks stock for a product
    steps:
      - intent: check_stock
        entities:
          - product: "iPhone 16"
      - slot_was_set:
          - product: "iPhone 16"
      - action: action_check_stock

  - story: User checks stock for product with spec and color
    steps:
      - intent: check_stock
        entities:
          - product: "Macbook Air"
          - variant_spec: "256GB"
          - variant_color: "bạc"
      - slot_was_set:
          - product: "Macbook Air"
          - variant_name: "256GB"
          - variant_color: "bạc"
      - action: action_check_stock

  - story: User checks stock for product with only spec
    steps:
      - intent: check_stock
        entities:
          - product: "iPhone 16"
          - variant_name: "256GB"
      - slot_was_set:
          - product: "iPhone 16"
          - variant_name: "256GB"
      - action: action_check_stock
