version: "3.1"

stories:
  # 2. HỎI THÔNG TIN SẢN PHẨM

  - story: Hỏi thông số cụ thể của sản phẩm
    steps:
      - intent: ask_product_spec
        entities:
          - product_name
          - spec_type
      - action: action_provide_product_spec

  # Story 2: User hỏi toàn bộ thông số kỹ thuật
  - story: Hỏi thông số kỹ thuật đầy đủ
    steps:
      - intent: ask_product_technical_specs
        entities:
          - product_name
      - action: action_provide_product_technical_specs

  # Story 3: User hỏi thông số nhưng thiếu tên sản phẩm
  - story: Hỏi thông số nhưng chưa có tên sản phẩm
    steps:
      - intent: ask_product_spec
        entities:
          - spec_type: "pin"
      - action: utter_ask_which_product
      - intent: inform
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_spec

  # Story 4: User hỏi thông số nhưng thiếu loại spec
  - story: Hỏi thông số nhưng chưa rõ spec nào
    steps:
      - intent: ask_product_spec
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: utter_ask_spec_type
      - intent: ask_product_spec
        entities:
          - product_name: "iPhone 16"
          - spec_type: "pin"
      - action: action_provide_product_spec

  - story: Hỏi thông tin sản phẩm (nêu rõ tên)
    steps:
      - intent: ask_product_info
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_info

  - story: Hỏi giá sản phẩm rồi chỉ xem
    steps:
      - intent: ask_product_price
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_price
      - action: utter_ask_if_want_to_order
      - intent: chitchat
      - action: utter_chitchat
      - slot_was_set:
          - product_name: null

  - story: Hỏi giá sản phẩm rồi quyết định mua
    steps:
      - intent: ask_product_price
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_price
      - action: utter_ask_if_want_to_order
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - slot_was_set:
          - product_name: null
          - variant_name: null
          - quantity: null

  - story: Hỏi chính sách bảo hành
    steps:
      - intent: ask_warranty
      - action: action_provide_warranty_info

  - story: Hỏi thông tin cửa hàng
    steps:
      - intent: ask_store
      - action: action_provide_store_info

  # 3. ĐẶT HÀNG
  - story: Quy trình đặt hàng đầy đủ (Full Happy Path)
    steps:
      - intent: ask_product_info
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_info
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order
      - slot_was_set:
          - product_name: null
          - variant_name: null
          - quantity: null

  - story: Đặt hàng nhanh
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order

  # - story: Đặt hàng tương tác (Interactive Ordering)vv
  #   steps:
  #     - intent: order
  #       entities:
  #         - product_name: "iPhone 16"
  #     - slot_was_set:
  #         - product_name: "iPhone 16"
  #     - action: order_form
  #     - active_loop: order_form
  #     - slot_was_set:
  #         - requested_slot: variant_name
  #     - intent: inform
  #       entities:
  #         - variant_name: "256GB"
  #     - action: order_form
  #     - slot_was_set:
  #         - requested_slot: quantity
  #     - intent: inform
  #       entities:
  #         - quantity: 2
  #     - action: order_form
  #     - active_loop: null
  #     - action: action_preview_order
  #     - intent: confirm_order
  #     - action: action_submit_order

  - story: Đặt hàng và hỏi tồn kho giữa chừng (Context Switching)
    steps:
      - intent: order
        entities:
          - product_name: "Samsung S24"
      - slot_was_set:
          - product_name: "Samsung S24"
      - action: order_form
      - active_loop: order_form
      - intent: check_stock
      - action: action_check_stock
      - action: order_form
      - active_loop: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order

  - story: Đặt hàng nhưng đổi ý (Correction)
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form
      - intent: inform
        entities:
          - product_name: "iPhone 15"
      - slot_was_set:
          - product_name: "iPhone 15"
      - action: order_form
      - intent: inform
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: order_form
      - active_loop: null
      - action: action_preview_order
      - intent: confirm_order
      - action: action_submit_order

  # 5. HỦY ĐƠN HÀNG
  - story: Hủy đơn có mã (người dùng cung cấp mã ngay)
    steps:
      - intent: cancel_order
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"
      - action: action_cancel_order

  # 6. TRẢ HÀNG
  - story: Yêu cầu trả hàng (chưa có mã)
    steps:
      - intent: request_return_order
      - action: return_order_form
      - active_loop: return_order_form
      - intent: inform_order_id
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"
      - intent: provide_return_reason
        entities:
          - return_reason: "hàng bị vỡ"
      - slot_was_set:
          - return_reason: "hàng bị vỡ"
      - action: return_order_form
      - active_loop: null
      - action: action_return_order

  - story: Yêu cầu trả hàng (có mã)
    steps:
      - intent: request_return_order
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"
      - action: return_order_form
      - active_loop: return_order_form
      - intent: provide_return_reason
        entities:
          - return_reason: "hàng bị lỗi"
      - slot_was_set:
          - return_reason: "hàng bị lỗi"
      - action: return_order_form
      - active_loop: null
      - action: action_return_order

  #  GIỎ HÀNG
  # Thêm sản phẩm vào giỏ hàng

  - story: Hỏi sản phẩm rồi thêm vào giỏ
    steps:
      - intent: ask_product_info
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_provide_product_info
      - intent: add_to_cart
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: add_to_cart_form
      - active_loop: add_to_cart_form
      - active_loop: null
      - action: action_add_to_cart

  - story: Thêm sản phẩm vào giỏ hàng
    steps:
      - intent: add_to_cart
      - action: add_to_cart_form
      - active_loop: add_to_cart_form
      - active_loop: null
      - action: action_add_to_cart

  - story: Xem giỏ hàng rồi thêm
    steps:
      - intent: view_cart
      - action: action_view_cart
      - intent: add_to_cart
      - action: add_to_cart_form
      - active_loop: add_to_cart_form
      - active_loop: null
      - action: action_add_to_cart

  - story: Xóa sản phẩm khỏi giỏ hàng
    steps:
      - intent: delete_from_cart
      - action: action_delete_from_cart

  # - story: user adds product to cart
  #   steps:
  #   - intent: add_to_cart
  #   - action: add_to_cart_form
  #   - active_loop: add_to_cart_form
  #   - action: add_to_cart_form
  #   - active_loop: null
  #   - action: action_add_to_cart

  # 4. TRA CỨU ĐƠN HÀNG
  - story: Tra đơn hàng bằng ID
    steps:
      - intent: ask_order
        entities:
          - order_id: "6673f8a7e0965e26f63111ed"
      - action: action_check_order
      - slot_was_set:
          - order_id: "6673f8a7e0965e26f63111ed"

  - story: Tra đơn hàng theo thời gian
    steps:
      - intent: ask_order
        entities:
          - time: "hôm nay"
      - action: action_check_order
      - slot_was_set:
          - time: "hôm nay"

  - story: Tra đơn hàng theo trạng thái
    steps:
      - intent: ask_order
        entities:
          - order_status: "đang giao"
      - action: action_check_order
      - slot_was_set:
          - order_status: "đang giao"

  - story: Tra đơn hàng mới nhất
    steps:
      - intent: ask_order
        entities:
          - order_direction: "newest"
      - action: action_check_order
      - slot_was_set:
          - order_direction: "newest"

  - story: Tra đơn hàng kết hợp filters
    steps:
      - intent: ask_order
        entities:
          - time: "hôm nay"
          - order_status: "đang giao"
      - action: action_check_order
      - slot_was_set:
          - time: "hôm nay"
          - order_status: "đang giao"

  - story: Tra đơn hàng chưa hoàn thành
    steps:
      - intent: ask_pending_orders
      - action: action_check_pending_orders

  # 6. KIỂM TRA HÀNG TỒN
  - story: Kiểm tra hàng tồn (chỉ có tên)
    steps:
      - intent: check_stock
        entities:
          - product_name: "iPhone 16"
      - slot_was_set:
          - product_name: "iPhone 16"
      - action: action_check_stock

  - story: Kiểm tra hàng tồn (kèm dung lượng & màu)
    steps:
      - intent: check_stock
        entities:
          - product_name: "Macbook Air"
          - variant_name: "256GB"
          - variant_color: "bạc"
      - slot_was_set:
          - product_name: "Macbook Air"
          - variant_name: "256GB"
          - variant_color: "bạc"
      - action: action_check_stock

  # 6. NGOÀI PHẠM VI / FALLBACK
  - story: Xử lý câu hỏi ngoài phạm vi
    steps:
      - intent: out_of_scope
      - action: utter_fallback
