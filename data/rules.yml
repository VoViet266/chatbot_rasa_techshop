version: "3.1"

rules:
  ############################################
  # 1. Khởi động & slot
  ############################################
  - rule: Restart slot
    steps:
      - intent: restart_slot
      - action: action_restart_slot

  ############################################
  # 2. FAQ
  ############################################
  - rule: Respond to overheating FAQ
    condition:
      - active_loop: null
    steps:
      - intent: faq_overheating
      - action: utter_faq_overheating

  - rule: Respond to connection issue FAQ
    condition:
      - active_loop: null
    steps:
      - intent: faq_connection_issue
      - action: utter_faq_connection_issue

  - rule: Handle goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  ############################################
  # 3. Thông tin sản phẩm / cửa hàng / đơn hàng
  ############################################
  - rule: Provide product info
    steps:
      - intent: ask_product_info
      - action: action_provide_product_info

  - rule: Provide warranty info
    steps:
      - intent: ask_warranty
      - action: action_provide_warranty_info

  - rule: Provide store info
    steps:
      - intent: ask_store
      - action: action_provide_store_info

  - rule: Provide order info
    steps:
      - intent: ask_order
      - action: action_provide_order_info

  ############################################
  # 4. Gợi ý sản phẩm
  ############################################
  - rule: Suggest products by price
    steps:
      - intent: suggest_product_price
      - action: action_suggest_product

  - rule: Suggest products by RAM
    steps:
      - intent: suggest_product_ram
      - action: action_suggest_product

  - rule: Suggest products by battery
    steps:
      - intent: suggest_product_battery
      - action: action_suggest_product

  - rule: Suggest products by storage
    steps:
      - intent: suggest_product_storage
      - action: action_suggest_product

  - rule: Suggest products by price and RAM
    steps:
      - intent: suggest_product_combine
      - action: action_suggest_product

  ############################################
  # 5. Đặt hàng (form)
  ############################################
  - rule: Activate order form
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form

  - rule: Submit order form when completed
    condition:
      - active_loop: order_form
    steps:
      - intent: confirm_order
      - action: action_submit_order

  ############################################
  # 6. Xử lý lỗi hoặc ngoài phạm vi
  ############################################
  - rule: Handle out of scope or fallback
    steps:
      - or:
          - intent: out_of_scope
          - intent: nlu_fallback
      - action: utter_fallback
