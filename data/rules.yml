version: "3.1"

rules:
  - rule: Xử lý chào hỏi
    steps:
      - intent: greet
      - action: action_get_user_info
      - action: utter_greet

  - rule: Xử lý tạm biệt
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Khởi động lại slot
    steps:
      - intent: restart_slot
      - action: action_restart_slot

  - rule: FAQ - Máy nóng
    condition:
      - active_loop: null
    steps:
      - intent: faq_overheating
      - action: utter_faq_overheating

  - rule: FAQ - Lỗi kết nối
    condition:
      - active_loop: null
    steps:
      - intent: faq_connection_issue
      - action: utter_faq_connection_issue

  - rule: Cung cấp thông tin sản phẩm
    steps:
      - intent: ask_product_info
      - action: action_provide_product_info

  - rule: Cung cấp thông tin bảo hành
    steps:
      - intent: ask_warranty
      - action: action_provide_warranty_info

  - rule: Cung cấp thông tin cửa hàng
    steps:
      - intent: ask_store
      - action: action_provide_store_info

  - rule: Cung cấp thông tin (chung chung) về đơn hàng
    steps:
      - intent: ask_order
      - action: action_provide_order_info

  - rule: Gợi ý sản phẩm theo giá
    steps:
      - intent: suggest_product_price
      - action: action_suggest_product

  - rule: Gợi ý sản phẩm theo RAM
    steps:
      - intent: suggest_product_ram
      - action: action_suggest_product

  - rule: Gợi ý sản phẩm theo Pin
    steps:
      - intent: suggest_product_battery
      - action: action_suggest_product

  - rule: Gợi ý sản phẩm theo dung lượng
    steps:
      - intent: suggest_product_storage
      - action: action_suggest_product

  - rule: Gợi ý sản phẩm (kết hợp)
    steps:
      - intent: suggest_product_combine
      - action: action_suggest_product

  - rule: Kích hoạt form đặt hàng
    steps:
      - intent: order
      - action: order_form
      - active_loop: order_form

  - rule: Gửi form đặt hàng khi hoàn tất
    condition:
      - active_loop: order_form
    steps:
      - intent: confirm_order
      - action: action_submit_order
      - active_loop: null

  - rule: Người dùng chọn chi nhánh
    steps:
      - intent: select_branch
      - action: action_confirm_after_branch

  - rule: Show variant
    steps:
      - intent: show_variant_details
      - action: action_show_variant_details

  - rule: Xử lý ngoài phạm vi hoặc không hiểu
    steps:
      - or:
          - intent: out_of_scope
          - intent: nlu_fallback
      - action: utter_fallback

  # - rule: Bắt đầu quy trình thêm vào giỏ hàng
  #   steps:
  #     - intent: add_to_cart
  #     - action: add_to_cart_form
  #     - active_loop: add_to_cart_form

  - rule: Hoàn tất form và gọi action_add_to_cart
    condition:
      - active_loop: add_to_cart_form
    steps:
      - action: add_to_cart_form
      - active_loop: null
      - action: action_add_to_cart
